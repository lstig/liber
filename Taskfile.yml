version: '3'

vars:
  MODULE:
    sh: go list -m
  BUILD_BIN: out/liber

tasks:
  build:
    desc: Build liber binary
    deps:
      - css
      - js
      - templ
    cmds:
      - go build -o {{ .BUILD_BIN }} {{ .MODULE }}/cmd/liber

  run:
    desc: Run a local development server
    cmds:
      - air --build.bin {{ .BUILD_BIN }} server --dev

  css:
    internal: true
    cmds:
      - yarn postcss -o web/dist/main.css web/src/*.css
    sources:
      - web/src/**/*.css
    generates:
      - web/dist/main.css

  js:
    internal: true
    cmds:
      - yarn rollup --config --silent
    sources:
      - web/src/**/*.js
    generates:
      - web/dist/bundle.min.js

  templ:
    internal: true
    cmds:
      - templ generate
